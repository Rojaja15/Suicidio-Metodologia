# Analisis de Variancia (ANOVA)

## Librerias

```{r}

library(tidyverse)
library(fastDummies)
library(FactoMineR)
library(factoextra)
library(cluster)
library(dendextend)
library(caret)
library(reticulate)
library(htmltools)
library(IRdisplay)
library(readxl)
library(dplyr)
library(ggplot2)
library(tidyr)
library(lubridate)
library(psych)
library(ggcorrplot)
library(janitor)
library(summarytools)
library(broom)
library(readxl)
library(cowplot)

```

## Funciones

```{r}

inercia_intraclase <- function(datos, grupos) {
  # Combina los datos y los grupos en una sola tabla
  tabla <- cbind(datos, grupos)

  # Calcula los centroides (puntos medios) de cada grupo
  centroides <- lapply(unique(grupos), function(id_grupo) {
    subconjunto <- subset(tabla, grupos == id_grupo)
    apply(subconjunto[, 1:(ncol(subconjunto)-1)], 2, mean)
  })

  # Calcula la suma de las distancias al cuadrado de cada punto a su centroide
  suma_cuadrados <- sum(sapply(unique(grupos), function(id_grupo) {
    subconjunto <- subset(tabla, grupos == id_grupo, select = -grupos)
    centroide_actual <- centroides[[id_grupo]]

    # Resta el centroide a cada punto y calcula la suma de cuadrados
    sum(sweep(subconjunto, 2, centroide_actual, "-")^2)
  }))

  return(suma_cuadrados)
}

```

```{r}

options(tibble.width = Inf)

```

```{r}

datos_crudos <- read_excel("Datos.xlsx")

```

```{r}

head(datos_crudos)

```


# ANOVA

Una vez creado los clústers, se crea una columna con el clústers correspondiente al `df` y se utiliza como nuevo factor de agrupación y se hacen los anova correspondientes.|

```{r}

df_num <- df %>%
  select(where(is.numeric)) %>%
  na.omit()      # opcional, elimina filas con NA

```

```{r}

set.seed(123)
k <- 3  # Número de clusters
clust <- kmeans(df_num, centers = k)

df$cluster <- as.factor(clust$cluster)

```

```{r}

# Seleccionar variables numéricas
num_vars <- df %>% select(where(is.numeric)) %>% names()

resultados_anova <- list()

for (var in num_vars) {
  formula <- as.formula(paste(var, "~ cluster"))
  modelo <- aov(formula, data = df)

  resultados_anova[[var]] <- summary(modelo)
  cat("\n\n============================================\n")
  cat("ANOVA para:", var, "\n")
  print(summary(modelo))
}

```

```{r}

for (var in num_vars) {
  print(
    ggplot(df, aes(x = cluster, y = !!sym(var), fill = cluster)) +
      geom_boxplot(alpha = 0.7) +
      labs(title = paste("Boxplot de", var, "por clúster"),
           x = "Clúster",
           y = var) +
      theme_minimal()
  )
}

```

```{r}

tabla_anova <- data.frame()

for (var in num_vars) {
  fm <- as.formula(paste(var, "~ cluster"))
  modelo <- aov(fm, data = df)
  tidy_result <- tidy(modelo) %>% mutate(variable = var)
  tabla_anova <- rbind(tabla_anova, tidy_result)
}

tabla_anova

```







